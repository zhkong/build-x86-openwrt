# ============================================================
# ImmortalWrt ImageBuilder 软件包配置
# 用于 x86_64 平台
# ============================================================

# 设备配置
TARGET="x86"
SUBTARGET="64"
PROFILE="generic"

# ==================== 要安装的软件包 ====================

# LuCI Web 界面（精简版，旁路由专用）
PACKAGES_LUCI="
    luci
    luci-ssl
    luci-app-firewall
    luci-mod-admin-full
    luci-mod-network
    luci-mod-status
    luci-mod-system
    luci-theme-argon
    luci-theme-bootstrap
"

# RPCD 模块 (LuCI 需要)
PACKAGES_RPCD="
    rpcd-mod-file
    rpcd-mod-luci
    rpcd-mod-rrdns
    rpcd-mod-ucode
"

# 中文语言包
PACKAGES_LANG_ZH="
    luci-i18n-base-zh-cn
    luci-i18n-firewall-zh-cn
    luci-i18n-ttyd-zh-cn
    luci-i18n-argon-config-zh-cn
"

# 系统工具（精简版，旁路由最小化）
PACKAGES_TOOLS="
    ttyd
    zsh
    curl
    ca-certificates
"

# LuCI 应用
PACKAGES_LUCI_APPS="
    luci-app-ttyd
    luci-app-openclash
"

# OpenClash 相关依赖（旁路由必需）
# 注意：已移除 ruby 相关包（编程语言），OpenClash 可能需要这些依赖才能正常工作
PACKAGES_OPENCLASH="
    coreutils
    coreutils-nohup
    bash
    jsonfilter
    ipset
    ip-full
    iptables-mod-tproxy
    iptables-mod-extra
    iptables-mod-ipopt
    kmod-ipt-tproxy
    kmod-ipt-extra
    kmod-ipt-ipopt
    dnsmasq-full
    libcap
    libcap-bin
    kmod-tun
    kmod-inet-diag
    unzip
    luci-compat
"

# ==================== 要移除的软件包 ====================

# IPv6 相关包（禁用 IPv6）
PACKAGES_DISABLED_IPV6="
    -kmod-ipv6
    -odhcp6c
    -odhcpd-ipv6only
    -luci-proto-ipv6
    -ip6tables
    -kmod-ip6tables
    -kmod-nf-ipv6
    -kmod-ipv6
    -libip6tc
    -libxtables
"

# 无线相关包（禁用 WiFi）
PACKAGES_DISABLED_WIFI="
    -hostapd-common
    -wpad-basic
    -wpad-basic-mbedtls
    -wpad-basic-openssl
    -wpad-basic-wolfssl
    -wpad-openssl
    -wpad-mbedtls
    -wpad-wolfssl
    -kmod-mac80211
    -kmod-cfg80211
    -kmod-ath
    -kmod-ath9k
    -kmod-ath9k-common
    -kmod-ath9k-htc
    -kmod-ath10k
    -kmod-rt2x00-lib
    -kmod-rt2x00-usb
    -kmod-rt2x00-pci
    -kmod-rt2800-lib
    -kmod-rt2800-usb
    -kmod-rt2800-pci
    -kmod-rtl8187
    -kmod-rtl8192c-common
    -kmod-rtl8192ce
    -kmod-rtl8192cu
    -kmod-rtl8192de
    -kmod-rtl8192se
    -kmod-rtl8723bs
    -kmod-rtl8723bu
    -kmod-rtl8812au-ct
    -kmod-rtl8821ae
    -kmod-rtl8821cu
    -kmod-rtl8xxxu
    -kmod-rtlwifi
    -kmod-rtlwifi-btcoexist
    -kmod-rtlwifi-pci
    -kmod-rtlwifi-usb
    -kmod-wl
    -wifi-scripts
    -wireless-regdb
    -iw
    -iwinfo
    -libiwinfo
    -libiwinfo-data
    -luci-app-wireless
"

# 测试和调试工具（禁用）
PACKAGES_DISABLED_TEST="
    -gdb
    -gdbserver
    -strace
    -tcpdump
    -wireshark-common
    -wireshark-cli
"

# USB 相关包（禁用所有 USB 功能）
PACKAGES_DISABLED_USB="
    -kmod-usb-core
    -kmod-usb2
    -kmod-usb3
    -kmod-usb-ohci
    -kmod-usb-uhci
    -kmod-usb-ehci
    -kmod-usb-xhci
    -kmod-usb-hid
    -kmod-usb-audio
    -kmod-usb-storage
    -kmod-usb-storage-extras
    -kmod-usb-storage-uas
    -kmod-usb-net
    -kmod-usb-net-asix
    -kmod-usb-net-asix-ax88179
    -kmod-usb-net-cdc-eem
    -kmod-usb-net-cdc-ether
    -kmod-usb-net-cdc-mbim
    -kmod-usb-net-cdc-ncm
    -kmod-usb-net-cdc-subset
    -kmod-usb-net-dm9601-ether
    -kmod-usb-net-hso
    -kmod-usb-net-huawei-cdc-ncm
    -kmod-usb-net-ipheth
    -kmod-usb-net-kalmia
    -kmod-usb-net-kaweth
    -kmod-usb-net-mcs7830
    -kmod-usb-net-pegasus
    -kmod-usb-net-qmi-wwan
    -kmod-usb-net-rndis
    -kmod-usb-net-rtl8150
    -kmod-usb-net-rtl8152
    -kmod-usb-net-sierrawireless
    -kmod-usb-net-smsc95xx
    -kmod-usb-net-sr9700
    -kmod-usb-serial
    -kmod-usb-serial-ch341
    -kmod-usb-serial-cp210x
    -kmod-usb-serial-ftdi
    -kmod-usb-serial-option
    -kmod-usb-serial-pl2303
    -kmod-usb-serial-qualcomm
    -kmod-usb-serial-sierrawireless
    -kmod-usb-serial-wwan
    -kmod-usb-wdm
    -kmod-usb-acm
    -kmod-usb-printer
    -kmod-usb-serial-ark3116
    -kmod-usb-serial-belkin
    -kmod-usb-serial-dmx_usb_module
    -kmod-usb-serial-keyspan
    -kmod-usb-serial-keyspan-pda
    -kmod-usb-serial-mos7720
    -kmod-usb-serial-mos7840
    -kmod-usb-serial-oti6858
    -kmod-usb-serial-qcserial
    -kmod-usb-serial-simple
    -kmod-usb-serial-ti-usb
    -kmod-usb-serial-visor
    -usbutils
    -lsusb
"

# 旁路由不需要的功能（禁用）
PACKAGES_DISABLED_ROUTER="
    -odhcpd
    -odhcpd-ipv6only
    -ppp
    -ppp-mod-pppoe
    -ppp-mod-pppol2tp
    -ppp-mod-pptp
    -kmod-ppp
    -kmod-pppoe
    -kmod-pppol2tp
    -kmod-pptp
    -luci-proto-ppp
    -luci-app-package-manager
    -luci-i18n-package-manager-zh-cn
"

# SSL/TLS 库冲突解决（禁用 openssl 版本，使用 mbedtls）
PACKAGES_DISABLED_SSL="
    -libustream-openssl
"

# 编程语言相关包（禁用所有编程语言）
PACKAGES_DISABLED_LANGUAGES="
    -ruby
    -ruby-yaml
    -ruby-psych
    -ruby-pstore
    -ruby-dbm
    -ruby-bigdecimal
    -ruby-date
    -ruby-digest
    -ruby-enc
    -ruby-forwardable
    -ruby-stringio
    -python3
    -python3-base
    -python3-pip
    -python3-setuptools
    -python3-dev
    -lua
    -luac
    -lua5.1
    -lua5.3
    -perl
    -perlbase
    -perlbase-base
    -perlbase-config
    -perlbase-essential
    -perlbase-file
    -perlbase-getopt
    -perlbase-i18n
    -perlbase-selectsaver
    -perlbase-symbol
    -perlbase-tie
    -perlbase-xsloader
    -node
    -node-npm
    -php
    -php-cli
    -php-fpm
    -php-mod
    -go
    -golang
"

# 不必要的内核模块（禁用）
PACKAGES_DISABLED_KMODS="
    -kmod-sound-core
    -kmod-sound-hda-core
    -kmod-sound-hda-codec-realtek
    -kmod-sound-hda-codec-via
    -kmod-sound-hda-intel
    -kmod-sound-i8x0
    -kmod-sound-soc-core
    -kmod-sound-soc-intel
    -kmod-sound-soc-sst
    -kmod-video-core
    -kmod-video-uvc
    -kmod-video-gspca-core
    -kmod-video-pwc
"

# ==================== 辅助函数 ====================

# 获取所有要安装的包（合并并清理空行）
get_install_packages() {
    echo "$PACKAGES_LUCI $PACKAGES_RPCD $PACKAGES_LANG_ZH $PACKAGES_TOOLS $PACKAGES_LUCI_APPS $PACKAGES_OPENCLASH" | tr '\n' ' ' | sed 's/#[^"]*//g' | tr -s ' '
}

# 获取所有要禁用的包
get_disabled_packages() {
    echo "$PACKAGES_DISABLED_IPV6 $PACKAGES_DISABLED_WIFI $PACKAGES_DISABLED_TEST $PACKAGES_DISABLED_USB $PACKAGES_DISABLED_ROUTER $PACKAGES_DISABLED_SSL $PACKAGES_DISABLED_LANGUAGES $PACKAGES_DISABLED_KMODS" | tr '\n' ' ' | tr -s ' '
}

# 获取完整的包列表
get_all_packages() {
    echo "$(get_install_packages) $(get_disabled_packages)"
}
